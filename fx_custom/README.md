# è‡ªå®šç¾©æ•ˆæœå™¨é–‹ç™¼æŒ‡å— (Custom FX Development Guide)

æœ¬ç›®éŒ„ (`fx_custom/`) å­˜æ”¾æ‰€æœ‰çš„è‡ªå®šç¾© Python æ•ˆæœå™¨ã€‚ç³»çµ±æœƒé€é `__init__.py` è‡ªå‹•æƒæä¸¦è¼‰å…¥æ­¤ç›®éŒ„ä¸‹æ‰€æœ‰ä»¥ `fx_` é–‹é ­çš„æª”æ¡ˆï¼Œæ‚¨ç„¡éœ€æ‰‹å‹•ä¿®æ”¹ä»»ä½•æ ¸å¿ƒç¨‹å¼ç¢¼å³å¯æ–°å¢æ•ˆæœå™¨ã€‚

## ğŸš€ å¦‚ä½•æ–°å¢æ•ˆæœå™¨

### 1. å»ºç«‹æª”æ¡ˆ
åœ¨ `fx_custom/` ç›®éŒ„ä¸‹å»ºç«‹ä¸€å€‹æ–°çš„ Python æª”æ¡ˆï¼Œæª”åå¿…é ˆä»¥ `fx_` é–‹é ­ã€‚
ä¾‹å¦‚ï¼š`fx_distortion.py` æˆ– `fx_delay.py`ã€‚

### 2. å®šç¾©é¡åˆ¥ (Class)
åœ¨æª”æ¡ˆä¸­å®šç¾©æ‚¨çš„æ•ˆæœå™¨é¡åˆ¥ã€‚é¡åˆ¥åç¨±å³ç‚ºåœ¨ `fx_config.py` ä¸­å¼•ç”¨çš„åç¨±ã€‚

### 3. å¯¦ä½œè¦ç¯„
æ‚¨çš„é¡åˆ¥å¿…é ˆåŒ…å«ä»¥ä¸‹å…©å€‹æ–¹æ³•ï¼š

#### `__init__(self, **params)`
- ç”¨æ–¼åˆå§‹åŒ–åƒæ•¸ã€‚
- åƒæ•¸åç¨±æ‡‰èˆ‡ `fx_config.py` ä¸­çš„ `params` å°æ‡‰ã€‚

#### `__call__(self, input_array, sample_rate)`
- **æ ¸å¿ƒè™•ç†é‚è¼¯**ã€‚
- **è¼¸å…¥ (Input)**:
  - `input_array`: NumPy arrayï¼Œå½¢ç‹€ç‚º `(samples, 2)` (ç«‹é«”è²)ã€‚è³‡æ–™é¡å‹é€šå¸¸ç‚º `float32`ã€‚
  - `sample_rate`: æ•´æ•¸ (ä¾‹å¦‚ `32000` æˆ– `44100`)ã€‚
- **è¼¸å‡º (Output)**:
  - å¿…é ˆå›å‚³ä¸€å€‹å½¢ç‹€èˆ‡ `input_array` ç›¸åŒçš„ NumPy arrayã€‚
- **æ³¨æ„**: ç‚ºäº†æ”¯æ´ä½å»¶é²ä¸²æµï¼Œè«‹ç¢ºä¿æ‚¨çš„æ¼”ç®—æ³•èƒ½è™•ç†æ¥µå°çš„å€å¡Š (Block Size)ï¼Œä¾‹å¦‚ 32 samplesã€‚

## ğŸ“ ç¨‹å¼ç¢¼ç¯„ä¾‹

ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ Gain (å¢ç›Š) æ•ˆæœå™¨ç¯„ä¾‹ï¼š

```python
import numpy as np

class MyGain:
    """
    ç°¡å–®çš„éŸ³é‡æ§åˆ¶æ•ˆæœå™¨
    """
    def __init__(self, gain_db=0.0):
        # å°‡ dB è½‰æ›ç‚ºç·šæ€§å€ç‡: 10^(db/20)
        self.gain_factor = 10.0 ** (gain_db / 20.0)

    def __call__(self, input_array, sample_rate):
        # input_array shape: (num_samples, channels)
        
        # ç›´æ¥å°é™£åˆ—é€²è¡Œä¹˜æ³•é‹ç®— (NumPy Vectorization)
        output_array = input_array * self.gain_factor
        
        # ç¢ºä¿å›å‚³æ­£ç¢ºçš„æ ¼å¼
        return output_array
```

## âš™ï¸ å¦‚ä½•å•Ÿç”¨

å®Œæˆç¨‹å¼ç¢¼å¾Œï¼Œè«‹è‡³å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `fx_config.py` åŠ å…¥æ‚¨çš„æ•ˆæœå™¨ï¼š

```python
PLUGIN_CHAIN_CONFIG = [
    # ... å…¶ä»–æ•ˆæœå™¨
    {"type": "custom", "name": "MyGain", "params": {"gain_db": 6.0}},
]
```

## âš ï¸ æ³¨æ„äº‹é …

1. **æ•ˆèƒ½å„ªåŒ–**: è«‹ç›¡é‡ä½¿ç”¨ NumPy çš„å‘é‡åŒ–é‹ç®—ï¼Œé¿å…ä½¿ç”¨ Python åŸç”Ÿè¿´åœˆ (for-loop) é€é»è™•ç†ï¼Œä»¥ç¢ºä¿å³æ™‚éŸ³è¨Šè™•ç†çš„æ•ˆèƒ½ã€‚
2. **ç‹€æ…‹ä¿æŒ**: å¦‚æœæ‚¨çš„æ•ˆæœå™¨éœ€è¦è¨˜æ†¶ç‹€æ…‹ (ä¾‹å¦‚ Delay, Reverb, Filter)ï¼Œè«‹åœ¨ `__init__` åˆå§‹åŒ– Buffer æˆ–ç‹€æ…‹è®Šæ•¸ï¼Œä¸¦åœ¨ `__call__` ä¸­æŒçºŒæ›´æ–°å®ƒå€‘ã€‚
3. **æ¨¡çµ„åç¨±**: ç³»çµ±æœƒè‡ªå‹•å°‡ `fx_custom/fx_myfile.py` ä¸­çš„é¡åˆ¥åŒ¯å‡ºåˆ° `fx_custom` å¥—ä»¶å±¤ç´šã€‚åœ¨ `fx_config.py` ä¸­è¨­å®š `type: custom` å³å¯è‡ªå‹•å°æ‡‰ã€‚
